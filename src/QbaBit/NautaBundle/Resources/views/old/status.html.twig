

<!-- saved from url=(0085)https://secure.etecsa.net:8443/web/online.do?CSRFHW=aba3bfcf2bd9177c16e5f7247133c0b0& -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body onkeydown="windowKeyDown(event);" onbeforeunload="windowExitFunc(event);"><c:set var="nativelang" value="es_ES"></c:set>







<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-store">
<meta http-equiv="expires" content="0">
<meta http-equiv="keywords" content=" ">
<meta http-equiv="description" content=" ">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Nauta
</title>
<link href="{{ asset('bundles/qbabitnauta/wifi.css') }}" rel="stylesheet" type="text/css">
<link href="{{ asset('bundles/qbabitnauta/form.css') }}" rel="stylesheet" type="text/css">
<script type="text/javascript" src="{{ asset('bundles/qbabitcore/js/jquery.min.js') }}"></script>
<script type="text/javascript">

    //显示在线时间
    function $$(tt){return tt<10?"0"+tt : tt;};
    var today   = new Date();
    var hour  = $$(today.getHours() );
    var minu  = $$(today.getMinutes());
    var second= $$(today.getSeconds());
    var actime= 'null';
    if('notFound.jsp' != 'notFound.jsp')
    {
        var newWnd =window.open("notFound.jsp","_blank");newWnd.opener = null;
    }
    function set()
    {
        var loginTime=parseInt((new Date().getTime()-today.getTime())/1000);
        if(loginTime++ > 600000)
        {
            today =new Date() ;
            //你已经登录了一个星期了，时间重置！
            alert("Ha iniciado sesión en una semana. Reajuste el tiempo.");
        }
        if(actime > 0)
        {
            setonTime(actime);
            actime++;
        }
        else if(loginTime >0)
        {
            setonTime(loginTime);
        }
    }
    setInterval(set,1000);
    function setonTime(loginTime)
    {
        var hours   = 0;
        var minutes = 0;
        var seconds = 0;

        hours = Math.floor(loginTime/3600);
        minutes = Math.floor((loginTime%3600)/60);
        seconds = loginTime%60;

        if(hours <= 9)
        {
            hours="0"+hours;
        }
        if(minutes <= 9)
        {
            minutes="0"+minutes;
        }
        if(seconds <= 9)
        {
            seconds="0"+seconds;
        }
        var cdate = hours + ":" + minutes + ":" + seconds;
        document.getElementById('onlineTime').innerHTML = cdate;
    }

    var g_httpRequest        = null;

    var g_isSubmitLogout = false;

    //登录后提示退出
    function windowExitFunc(e)
    {
        var event= window.event||e;
        try
        {
            if(g_isSubmitLogout)
            {
                return false;
            }

            var message = "Visitar otros sitios web en esta página le llevará fuera de línea de forma anormal. Para visitar otros sitios web, haga clic en Cancelar y abra una nueva página.";

            if (event)
            {
                event.returnValue = message;
            }

        }
        catch(e)
        {
            alert("alert window error!!!");
        }
        return true;
    }

    function userSubmitLogout(forzada)
    {
        if(!confirm("Se le desconectará. ¿Seguro que quieres cerrar sesión?"))
        {
            return false;
        }

        logoutImpl(forzada);
        return true;
    }

    function logoutImpl(forzada)
    {
        pageOnunload(forzada);
    }

    function pageOnunload(forzada)
    {
        //if(!g_httpRequest){ g_httpRequest = createHttpRequest(); }
        var cookieCheck = document.getElementById("removeCookie");
        var removeCookie = "1";
        if (cookieCheck && cookieCheck.checked == true) {
            removeCookie = cookieCheck.value;
        }
        var g_httpRequest = createHttpRequest();
        if (g_httpRequest == null)
        {
            alert("Se desconecta de forma anormal. Por favor, póngase en contacto con el administrador de la red.");
            return false;
        }
        else
        {
            $.ajax({
                url: "{{ url("qba_bit_nauta_logout",{"user":user.data.username}) }}"+"/"+forzada,
                /* method:method,*/
                data: null,
                type: "GET",
                /*  dataType : 'html',*/
                enctype: 'multipart/form-data',
                success: function(e){
                  if(e.return==0)
                      alert("No se pudo cerrar la session");
                  else
                  {
                      document.location.href = e.url;
                  }
                },
                error: function(){
                    alert("No se pudo cerrar la session");

                },
                processData: false,
                contentType: false

            });
         /*


            var urlParam = "ATTRIBUTE_UUID=5D2F4A62469AE9D1EA957FA855ADDBA6&"

  +data

                + "&domain="


                +"&remove="+removeCookie;
            g_httpRequest.open("GET", "/LogoutServlet?CSRFHW=aba3bfcf2bd9177c16e5f7247133c0b0&" + urlParam, true);
            g_httpRequest.send();
            var isOut;
            g_httpRequest.onreadystatechange=function()
            {
                if (g_httpRequest.readyState==4 && g_httpRequest.status==200)
                {
                    if(g_httpRequest.responseText.indexOf("SUCCESS") != -1)
                    {
                        if (g_httpRequest.responseText.indexOf("REMOVE_AUTHINFO_SUCCESS") != -1)
                        {
                            alert("???logout_result.removecookie.success???");
                        }
                        else if(g_httpRequest.responseText.indexOf("ERROR") != -1){
                            alert("???logout_result.removecookie.fail???");
                        }
                        isOut = true;
                    }
                    else
                    {
                        isOut = true;
                    }
                    if(isOut == false)
                    {
                        alert("Se desconecta de forma anormal. Por favor, póngase en contacto con el administrador de la red.");
                        return;
                    }
                    else if (isOut == null)
                    {
                        alert("Su red está desconectada. Compruébelo por favor.");
                        g_isSubmitLogout = true;
                        logoutToFirstPage();
                        return;
                    }
                    // alert("???logout_result.logout_success???");
                    g_isSubmitLogout = true;
                    //window.location.replace("http://www.google.com");
                    logoutToFirstPage();
                }
                else
                {
                    if(g_httpRequest.readyState==4 && g_httpRequest.status != 200)
                    {
                        alert("request error "  + g_httpRequest.status);
                        return false;
                    }
                }
            }*/
        }
    }
    function logoutToFirstPage()
    {
        //[false alarm:Cross-Site Scripting: Reflected]
        window.location.href="/nauta_etecsa/OnlineURL/offline.jsp?CSRFHW=aba3bfcf2bd9177c16e5f7247133c0b0&lang="+'es_ES';
    }
    function IEkeydown(event)
    {
        if ((event.keyCode == 8)||  //屏蔽退格删除键
            (event.keyCode == 114)||
            (event.keyCode == 116)||            //屏蔽 F5 刷新键
            (event.keyCode == 122))             //屏蔽 F12 刷新键
        {
            event.keyCode=0;
            event.returnValue=false;
        }

        if ((event.altKey)&& ((event.keyCode==37)||(event.keyCode==39))) // 屏蔽 Alt + -> 和 Alt+ <-
        {
            event.returnValue=false;
        }

        if (event.ctrlKey ||(event.shiftKey)&&(event.keyCode==121)) //屏蔽 Ctrl 键 和 shift+F10
        {
            event.returnValue=false;
        }
    }

    function FFkeydown(event)
    {
        var key = event.which;
        if ((key == 8) || (key == 114)|| (key == 116)||  (key == 122))                      //屏蔽退格删除键(event.keyCode ==   8)||//屏蔽 F5 刷新键//屏蔽 F12 刷新键
        {
            key=0;
            event.preventDefault();
        }
        if ((event.altKey)&& ((key==37)||(key==39))) // 屏蔽 Alt + -> 和 Alt+ <-
        {
            event.preventDefault();
        }
        if (event.ctrlKey ||(event.shiftKey)&&(key==121)) //屏蔽 Ctrl 键 和 shift+F10
        {
            event.preventDefault();
        }
    }
    function windowKeyDown(e)
    {
        if (window.event)
        {
            var event = window.event;
            IEkeydown(event);
        }
        else
        {
            var event= e;
            FFkeydown(event);
        }
    }

    function createHttpRequest()
    {
        var request;
        try
        {
            request = new XMLHttpRequest();
        }
        catch (trymicrosoft)
        {
            try
            {
                request = new ActiveXObject("Microsoft.XMLHTTP");
            }
            catch (failed)
            {
                try
                {
                    request = new ActiveXObject("Msxml2.XMLHTTP");
                }
                catch (othermicrosoft)
                {
                    request = null;
                }
            }
        }
        return request;
    }

    function windowOnunload()
    {
        if (!g_isSubmitLogout)
        {
            logoutImpl();
        }
    }

    function updateAvailableTime()
    {
        var g_httpRequest = createHttpRequest();
        if (g_httpRequest == null)
        {
            alert("Actualización disponible tiempo falle.");
            return;
        }
        else
        {
            $.ajax({
                url: "{{ url("qba_bit_nauta_status",{"user":user.data.username,"ajax":true}) }}",
                /* method:method,*/
                data: null,
                type: "GET",
                /*  dataType : 'html',*/
                enctype: 'multipart/form-data',
                success: function(e){
                    document.getElementById("availableTime").innerHTML = e.amount;
                },
                error: function(){
                    alert("Actualización disponible tiempo falle.");
                    document.getElementById("availableTime").innerHTML = "--:--:--";
                },
                processData: false,
                contentType: false

            });

            /*g_httpRequest.open("post", , true);
            g_httpRequest.send();
            g_httpRequest.onreadystatechange=function()
            {

                if (g_httpRequest.readyState==2 && g_httpRequest.status==200)
                {

                    //得到最新的有效时间
                    var responseText = g_httpRequest.responseText;
                    console.log("aaaaa");
                    if (responseText.indexOf("errorop") != -1)
                    {
                        alert("Actualización disponible tiempo falle.");
                        document.getElementById("availableTime").innerHTML = "--:--:--";
                        return;
                    }
                    //写入页面
                    document.getElementById("availableTime").innerHTML = responseText;

                }
                else if(g_httpRequest.readyState==4 && g_httpRequest.status != 200)
                {
                    alert("request error "  + g_httpRequest.status);
                    return false;
                }
            }*/
        }
    }
</script>



<div id="header">
    <img src="{{ asset('bundles/qbabitnauta/nauta_wifi.jpg') }}" id="logo_nauta">
    <img src="{{ asset('bundles/qbabitnauta/etecsa.jpg') }}" id="logo_etecsa">
</div>
<div id="contenedor" style="height: 100%;">
    <div id="int" style="width: 500px;">
        <div class="blq">
            <div class="title">
                Bienvenido
            </div>
            <div class="blq_int clearfix">
                <div id="cont" style="background-color: white; width: 400px; margin: 0 auto; text-align: center;">
                    <div style="padding: 20px; text-align: center;">
                        <div>
                            <div style="float: left;">
                                <img src="{{ asset('bundles/qbabitnauta/conected.png') }}">
                            </div>
                            <span style="float: left; padding-top: 15px; padding-left: 10px; font-weight: bold;">Usted está conectado </span>
                        </div>
                        <br class="clearfloat">
                        <table id="logout" align="center">
                            <tbody>
                            <tr>
                                <td class="key">
                                    Usuario
                                </td>
                                <td>
                                    {{ user.data.username }}
                                </td>
                            </tr>
                            <tr>
                                <td class="key">
                                    Tiempo consumido
                                </td>
                                <td id="onlineTime">00:00:00</td>
                            </tr>
                            <tr>
                                <td class="key">
                                    Tiempo disponible
                                </td>
                                <td id="availableTime"></td>
                            </tr>
                            </tbody>
                        </table>
                        <br>
                        <input class="btn" name="refrescar" value="Actualizar" onclick="updateAvailableTime();" type="button">
                        <input class="btn" name="logout" value="Cerrar sesión" onclick="userSubmitLogout(false);" type="button">
                        <input style="margin-top:5px" class="btn" name="logout" value="Cerrar sesión Forzosa" onclick="userSubmitLogout(true);" type="button">
                    </div>
                    <img src="{{ asset('bundles/qbabitnauta/nauta_wifi_popup.jpg') }}" style="padding: 0 5px 15px 0; width: 190px;">
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    window.onload = function ()
    {
        updateAvailableTime();
        set();
    }
</script>
</body></html>